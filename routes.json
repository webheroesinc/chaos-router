{
    "api": {
	"login": {
	    ".method": "login",
	    ".validate": [
		["required_not_empty", "{params[email]}", "{params[password]}"]
	    ]
	},
	"me": {
	    ".method": "user_info"
	},
	"logout": {
	    ".method": "logout"
	},
	"block": {
	    "user": {
		":id": {
		    ".method": "block_user",
		    ".validate": [
			["required_not_empty", "{path[id]}"]
		    ]
		}
	    }
	},
	"unblock": {
	    "user": {
		":id": {
		    ".method": "unblock_user",
		    ".validate": [
			["required_not_empty", "{path[id]}"]
		    ]
		}
	    }
	},
	"create": {
	    "client": {
		".method": "create_client",
		".validate": [
		    ["required_not_empty", "{params[company]}"]
		]
	    },
	    "user": {
		".method": "create_user",
		".validate": [
		    ["required_not_empty", "{params[first_name]}", "{params[last_name]}", "{params[email]}", "{params[password]}"]
		]
	    },
	    "job": {
		".method": "create_job",
		".validate": [
		    ["client_id_exists", "{params[client_id]}"],
		    ["required_not_empty", "{params[name]}"]
		]
	    }
	},
	"archive": {
	    "client": {
		".method": "archive_client",
		".validate": [
		    ["client_id_exists", "{params[client_id]}"]
		]
	    },
	    "user": {
		".method": "archive_user",
		".validate": [
		    ["required_not_empty", "{params[user_id]}"]
		]
	    },
	    "job": {
		".method": "archive_job",
		".validate": [
		    ["job_id_exists", "{params[job_id]}"]
		]
	    }
	},
	"unarchive": {
	    "client": {
		".method": "unarchive_client",
		".validate": [
		    ["client_id_exists", "{params[client_id]}"]
		]
	    },
	    "user": {
		".method": "unarchive_user",
		".validate": [
		    ["required_not_empty", "{params[user_id]}"]
		]
	    },
	    "job": {
		".method": "unarchive_job",
		".validate": [
		    ["job_id_exists", "{params[job_id]}"]
		]
	    }
	},
	"update": {
	    "client": {
		":id": {
		    ".method": "update_client",
		    ".validate": [
			["client_id_exists", "{path[id]}"]
		    ]
		}
	    },
	    "user": {
		":id": {
		    ".method": "update_user",
		    ".validate": [
			["user_id_exists", "{path[id]}"]
		    ]
		}
	    },
	    "auth": {
		":id": {
		    ".method": "update_auth",
		    ".validate": [
			["user_id_exists", "{path[id]}"],
			["required_not_empty", "{params[email]}", "{params[password]}", "{params[new_password]}"]
		    ]
		}
	    },
	    "job": {
		":id": {
		    ".method": "update_job",
		    ".validate": [
			["job_id_exists", "{path[id]}"],
			["client_id_exists", "{params[client_id]}"]
		    ]
		}
	    }
	},
        "users": {
           ".table": "users",
	    ".where": "users.active = 1",
	    ".columns": [
		["users.user_id",	"user_id"],
		["users.email",		"email"],
		["users.blocked",	"blocked"],
		["users.user_level",	"user_level"],
		["users.first_name",	"first_name"],
		["users.last_name",	"last_name"]
	    ],
            ".structure": {
                ".key": "{user_id}",
                "id": ": {user_id}",
                "email": "{email}",
                "level": ":< user_level",
                "blocked": ": bool({blocked})",
                "name": {
		    "first": "{first_name}",
		    "last": "{last_name}",
		    "full": "{first_name} {last_name}"
		}
            },
            ":id": {
                ".base": "..",
                ".validate": [
		    ["is_digit", "{path[id]}"]
                ],
                ".where": "user_id = {path[id]}",
                ".structure_update": {
                    ".single": true
                }
            }
        },
        "clients": {
           ".table": "clients",
	    ".where": "clients.active = 1",
	    ".columns": [
		["clients.client_id",		"client_id"],
		["clients.company_name",	"company_name"],
		["jobs.job_id",			"job_id"],
		["jobs.job_name",		"job_name"]
	    ],
	    ".join": [
		[ "jobs",
		  ["jobs", "client_id"],
		  ["clients", "client_id"]
		]
	    ],
            ".structure": {
                ".key": ["{client_id}", "jobs"],
                "id": ":< client_id",
                "company": ":< company_name",
                "jobs": {
                    ".key": "{job_id}",
                    "id": ":< job_id",
                    "name": ":< job_name"
		}
            },
            ":id": {
                ".base": "..",
                ".validate": [
		    ["is_digit", "{path[id]}"]
                ],
                ".where": "clients.client_id = {path[id]}",
                ".structure_update": {
                    ".single": true
                }
            }
        },
        "jobs": {
            ".table": "jobs",
	    ".where": "jobs.active = 1 AND clients.active = 1",
	    ".columns": [
		["clients.client_id",		"client_id"],
		["clients.company_name",	"company_name"],
		["jobs.job_id",			"job_id"],
		["jobs.job_name",		"job_name"]
	    ],
	    ".join": [
		[ "clients",
		  ["clients", "client_id"],
		  ["jobs", "client_id"]
		]
	    ],
            ".structure": {
                ".key": "{job_id}",
                "id": ":< job_id",
                "name": ":< job_name",
		"client": {
		    "id": ":< client_id",
		    "company": ":< company_name"
		}
            },
            ":id": {
                ".base": "..",
                ".validate": [
		    ["is_digit", "{path[id]}"]
                ],
                ".where": "job_id = {path[id]}",
                ".structure_update": {
                    ".single": true
                }
            }
        },
	"cookies": {
	    ".method": "cookies"
	},
	"auth": {
	    "is": {
		":level": {
		    ".method": "is_level"
		}
	    }
	}
    }
}
